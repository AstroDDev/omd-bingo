<!DOCTYPE html>
<html>
    <link rel="stylesheet" href="style.css">
    <head>
        <title>OMD Bingo Card</title>
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <link rel="icon" type="image/x-icon" href="resources/icons/AIRA_PixelArt.ico">
    </head>
    <body>
        <p>
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
            BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO BINGO 
        </p>
        <svg>
            <defs>
                <filter id="filter" color-interpolation-filters="sRGB" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse">
                    <feImage href="https://raw.githubusercontent.com/AstroDDev/omd-bingo/refs/heads/main/resources/filters/disp-mapV3.png" result="DSPIMG"/>
                    <feDisplacementMap id="disp_map" in="SourceGraphic" in2="DSPIMG" scale="0" xChannelSelector="R" yChannelSelector="B" x="0%" y="0%" width="100%" height="100%" result="displacementMap"/>
                </filter>
            </defs>
        </svg>
        <div class="board">
            <div class="row">
                <div onclick="bingoCheck(0)" class="tile" id="Alt96">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(1)" class="tile" id="Hydra">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(2)" class="tile" id="AltRoller">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(3)" class="tile" id="Pain">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(4)" class="tile" id="Stamper">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
            </div>
            <div class="row">
                <div onclick="bingoCheck(5)" class="tile" id="52">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(6)" class="tile" id="AltWiper">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(7)" class="tile" id="Stringer">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(8)" class="tile" id="Inkbrush">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(9)" class="tile" id="AltDynamo">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
            </div>
            <div class="row">
                <div onclick="bingoCheck(10)" class="tile" id="Range">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(11)" class="tile" id="AltRapidPro">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(12)" class="tile" id="AltTent">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(13)" class="tile" id="Gloogas">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(14)" class="tile" id="Splash">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
            </div>
            <div class="row">
                <div onclick="bingoCheck(15)" class="tile" id="Liter">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(16)" class="tile" id="AltHeavy">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(17)" class="tile" id="AltSquiffer">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(18)" class="tile" id="AltOctobrush">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(19)" class="tile" id="AltDapples">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
            </div>
            <div class="row">
                <div onclick="bingoCheck(20)" class="tile" id="AltZap">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(21)" class="tile" id="Brella">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(22)" class="tile" id="AltCharger">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(23)" class="tile" id="Slosher">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
                <div onclick="bingoCheck(24)" class="tile" id="AltTri">
                    <div class="checked">
                        <svg viewBox="0 0 120 120" class="unchecked">
                            <image width="120" height="120">
                        </svg>
                    </div>
                </div>
            </div>
        </div>
        <script defer>
            //Blob Stuff
            const feImage = document.getElementsByTagName("feImage")[0];
            const url = feImage.getAttribute("href");

            fetch(url)
                .then((response) => response.blob())
                .then((blob) => {
                    const objURL = URL.createObjectURL(blob);

                    feImage.setAttribute('href', objURL);
                });

            //Bingo Stuff
            const cells = document.getElementsByClassName("tile");
            const image_path = "resources/weapon-images/";
            const board_path = "resources/boards/"

            var cells_checked = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false];
            var cell_frame = 0;
            var cell_interval;

            const filter = document.getElementById("disp_map");

            function bingoCheck(index){
                resetFrames();

                cells_checked[index] = !cells_checked[index];
                cell_frame = cells_checked[index] ? 0 : 240;
                cells[index].children[0].children[0].children[0].style.display = "block";
                cells[index].children[0].children[0].children[0].style.filter = "url(#filter)";

                stepFrame(index);
                cell_interval = window.setInterval(() => {stepFrame(index);}, 40);
            }

            function resetFrames(){
                cell_frame = 0;
                filter.setAttribute("scale", cell_frame);

                window.clearInterval(cell_interval);

                for (var i = 0; i < cells.length; i++){
                    cells[i].children[0].children[0].children[0].style.filter = "";
                    cells[i].children[0].children[0].children[0].style.display = cells_checked[i] ? "none" : "block";
                }
            }

            function stepFrame(index){
                cell_frame += cells_checked[index] ? 30 : -30;
                filter.setAttribute("scale", cell_frame);
                cells[index].children[0].children[0].style.display = "none";
                cells[index].children[0].children[0].style.display = "block";

                if (cell_frame > 240 || cell_frame < 0){
                    resetFrames();
                }
            }

            const boardID = new URLSearchParams(window.location.search).get("id");
            var weapons = [];
            console.log(boardID);
            fetch(board_path + boardID + ".txt").then(r => r.text()).then(t => weapons = t.split(",")).then(() => {
                for (var i = 0; i < cells.length; i++){
                    var weaponName = weapons[i];
                    cells[i].id = weaponName;
                    cells[i].children[0].style.backgroundImage = "url('" + image_path + weaponName + "_Checked.png')";
                    cells[i].children[0].children[0].children[0].setAttribute("href", image_path + weaponName + "_Unchecked.png");
                }
            });
        </script>
    </body>
</html>
